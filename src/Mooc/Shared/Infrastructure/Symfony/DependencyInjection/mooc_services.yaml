services:
  # Databases
  Doctrine\ORM\EntityManager:
    factory: [CodelyTv\Mooc\Shared\Infrastructure\Doctrine\MoocEntityManagerFactory, create]
    arguments:
      - driver:   '%env(MOOC_DATABASE_DRIVER)%'
        host:     '%env(MOOC_DATABASE_HOST)%'
        port:     '%env(MOOC_DATABASE_PORT)%'
        dbname:   '%env(MOOC_DATABASE_NAME)%'
        user:     '%env(MOOC_DATABASE_USER)%'
        password: '%env(MOOC_DATABASE_PASSWORD)%'
      - '%env(APP_ENV)%'
    tags:
      - { name: codely.database_connection }
    public: true


  # Courses
  CodelyTv\Mooc\Courses\Domain\CourseRepository: 'CodelyTv\Mooc\Courses\Infrastructure\Persistence\DoctrineCourseRepository'

  # Notifiers
  codelytv.notifier.twitter:
    class: CodelyTv\Mooc\Courses\Infrastructure\TwitterNotifier
    arguments:
      - '%env(TWITTER_ACCESS_TOKEN)%'
      - '%env(TWITTER_ACCESS_TOKEN_SECRET)%'
      - '%env(TWITTER_CONSUMER_KEY)%'
      - '%env(TWITTER_CONSUMER_SECRET)%'

  codelytv.course.twitter_notifier_listener:
    class: CodelyTv\Mooc\Notifications\Application\TweetNewCourse\PublishNotificationOnCourseCreated
    tags:
      - { name: codelytv.course.create_twitter_listener, event: codelytv.course.created, method: onCourseCreated, priority: 1 }
    arguments:
      - '@codelytv.notifier.twitter'
